---
title: "第六章 链路层和局域网"
description: ""
lead: ""
date: 2021-04-09T23:23:04+08:00
lastmod: 2021-04-09T23:23:04+08:00
draft: false
images: []
menu: 
  docs:
    parent: "computer-network"
weight: 12
toc: true
---

## 6.2 差错检测与纠正技术

+ 差错检测和纠正比特(EDC)
+ 奇偶校验
+ 检验和方法
+ 循环冗余检测

### 6.2.1 奇偶校验

### 6.2.2 检验和方法

### 6.2.3 循环冗余检测

+ 循环冗余检测编码(CRC),也称为**多项式编码**
+ 生成多项式$G$,最高有效位的比特是1
+  
  $$
  D\cdot2^r \ \text{XOR}\ R=nG
  $$
+ 计算$R$
  $$
  R=\text{remainder}\frac{D\cdot 2^r}{G}
  $$

## 6.3 多路访问链路和协议

+ 两种类型的网络链路：点对点链路和广播链路
  + 点对点链路：由链路一段的单个发送方和链路另一端的单个接收方组成
  + 广播链路：它能够让多个发送和接收节点都连接到相同的、单一的、共享的广播信道上。
+ 多路访问协议：节点通过这些协议来规范它们在共享的广播信道上的传输行为
+ **碰撞**：因为所有的节点都能够传输帧，所以多个节点可能会同时传输帧。当发生这种情况时，所有节点同时接到多个帧；这就是说，传输的帧在所有的接收方处**碰撞**
+ 多路访问协议：
  + 信道划分协议
  + 随机接入协议
  + 轮流协议
+ 对于速率为$R$ bps的广播信道，多路访问协议应该具有的特征：
  + 当仅有一个节点发送数据时，该节点具有$R$ bps的吞吐量
  + 当有$M$个节点发送数据时，每个节点吞吐量为$R/M$ bps。这不必要求$M$个节点中的每一个节点总是有$R/M$的瞬间速率，而是每个节点在一些适当定义的时间间隔内应该有$R/M$的平均传输熟虑
  + 协议是分散的；这就是说不会因某主节点故障而使整个系统崩溃
  + 协议是简单的，使实现不昂贵

### 6.3.1 信道划分协议

+ 时分多路复用（TDM）：将时间划分为**时间帧**，并进一步划分每个时间帧为$N$个时隙。
+ 频分多路复用（FDM）：将$R$ bps信道划分为不同的频段
+ 码分多址（CDMA）：对每个节点分配一种不同的编码。然后每个节点用它唯一的编码来对它发送的数据进行编码，不同的节点能够同时传输。

### 6.3.2 随机接入协议

+ 一个传输节点总是以信道的全部速率进行发送。当有碰撞时，涉及碰撞的每个节点反复地重发它的帧，到该帧无碰撞地通过为止。但当一个节点经历一次碰撞时，它不必立刻重发该帧。相反，它在重发该帧之前等待一个随机时延。

#### 1. 时隙ALOHA

+ 当节点有一个新帧要发送时，它等到下一个时隙开始并在该时隙传输整个帧
+ 如果没有碰撞，该节点成功地传输它的帧，从而不需要考虑重传该帧
+ 如果有碰撞，该节点在时隙结束之前检测到这次碰撞。该节点以概率$p$在后续的每个时隙重传它的帧，知道该帧被无碰撞地传输出去。
+ 时隙多路访问协议的效率：当有大量的活跃节点且每个节点总有大量的帧要发送时，长期运行中成功时隙的份额。
+ 一个节点传输的概率是$p$，剩余节点不传输的概率是$(1-p)$。因此一个给定节点成功传送的概率是$p(1-p)^{N-1}$。因为有$N$个节点，任意一个节点成功传送的概率是$Np(1-p)^{N-1}$.

#### 2. ALOHA

+ 当一帧首次到达，节点立刻将该帧完整地传输进广播信道。如果一个传输的帧与一个或多个传输经历了碰撞，这个节点将立即以概率$p$重传该帧。否则，该节点等待一个帧传输时间。在次等待之后，它则以概率$p$传输该帧，或者以概率$1-p$在另一个帧时间等待。
+ 节点成功传输一次的概率是$p(1-p)^{2(N-1)}$
  
#### 3. 载波侦听多路访问(CSMA)

+ 载波侦听：一个节点在传输前先听信道。如果来自另一个节点的帧正在向信道上发送，节点则等待知道检测到一小段时间没有传输，然后开始传输。
+ 碰撞检测：当一个传输节点在传输时一直侦听此信道。如果它检测到另一个节点正在传输干扰帧，它就停止传输，在重复“侦听-空闲时传输”循环之间等待一段随机时间。
+ 具有碰撞检测的CSMA（CSMA/CD）
+ 广播信道的端到端信道传播时延在决定其性能方面起着关键的作用。该传播时延越长，载波侦听节点不能侦听到网络中另一个节点已经开始传输的机会就越大。

#### 4. CSMA/CD

+ 在多路访问协议中加入碰撞检测，通过不传输一个无用的、损坏的帧，将有助于改善协议的性能。
+ 运行：
   1. 适配器从网络层获得一条数据报，准备链路层帧，并将其放入帧适配器缓存中
   2. 如果适配器侦听到信道空闲，它开始传输帧。在另一方面，如果适配器侦听到信道正在忙，它将等待，直到侦听到没有信号能量时才开始传输帧。
   3. 在传输过程中，适配器监视来自其他使用该广播信道的适配器的能量的存在。
   4. 如果适配器传输整个帧而未检测到来自其他适配器的信号能量，该适配器就完成了该帧。在另一方面，如果适配器在传输时检测到来自其他适配器的能量，它中止传输。
   5. 中止传输后，适配器等待一个随机时间量，然后返回步骤2。
+ 当碰撞节点数量较少时，时间间隔较短；当碰撞节点数量较大时，时间间隔较长。
+ 二进制指数后退：一个帧发生了n次碰撞，则节点从$0,1,…,2^{n−1}$中随机选一个$K$值，然后该节点等待$K\cdot 512$比特时间。一共尝试传输16次，$n$最大取10，后面六次范围大小保持，16次均失败后放弃重传。
+ $$
  效率=\frac{1}{1+5d_{prop}/d_{trans}}
  $$

#### 5. CSMA/CD效率

+ 定义：当有大量的活跃几点，且每个节点有大量的帧要发送时，帧在信道中无碰撞地传输的那部分时间在长期运行时间中所占的份额。
+ 令$d_{porp}$表示信道能量在任意两个适配器之间传播所需要的最大时间，$d_{trans}$表示传输一个最大长度的以太网帧的时间。
+ 效率近似式
  $$
  效率=\frac{1}{1+5d_{prop}/d_{trans}}
  $$

### 6.3.3 轮流协议

1. 轮询协议：一个主节点轮询其他节点，告诉其他节点可以传输的帧的最大数量。例如802.15协议和蓝牙协议
   + 优点：避免碰撞和随机接入协议里面会出现的空时隙
   + 缺点：1.主节点故障，整个系统崩溃；2.引入了轮询时延
2. 令牌传递协议：一个称为令牌的小的特殊帧在节点之间以某种固定的次序进行交换。获得令牌的节点才可以传输数据，传输最大数目的帧。如果没有数据传输则应该把令牌立即转发给下一个节点。
    + 缺点：1.一个节点故障可能使整个信道崩溃；2.令牌环额外的开销和延迟。

## 6.4 交换局域网

### 6.4.1 链路层寻址和ARP

#### 1. MAC地址

+ 没有两块适配器具有相同的地址
+ 当某适配器要向某些目的适配器发送一个帧时，发送适配器将目的适配器的MAC地址插入到该帧中，并将该帧发送到局域网上。
+ 接收适配器接收到帧后，检查其中MAC地址是否与自己MAC地址相匹配，如果匹配则取出其中数据，向上层传递，如果不是，则丢弃该帧。
+ 广播：发送适配器需要让局域网上所有适配器都接受并处理某帧，则在该帧的目的地址中插入一个特殊的MAC地址(FF-FF-FF-FF-FF-FF)。

#### 2. 地址解析协议

+ 在网络层地址（IP）和链路层地址（MAC）之间进行转换
+ 每台主机或路由器在其内存中具有一个ARP表，这张表包含IP地址到MAC地址的映射关系。
+ 工作过程：
  + 如果发送方的ARP表具有该目的节点的表项，这个任务是很容易完成的。
  + 如果没有，则源向它的适配器传递一个ARP查询分组，并且指示适配器应用该MAC广播地址（FF-FF-FF-FF-FF-FF）来发送这个分组。适配器在链路层帧中封装这个ARP分组，用广播地址作为帧的目的地址，并将该帧传输到子网中。子网的其他适配器收到该查询分组后把在该帧中的ARP分组向上传递给ARP模块。这些ARP模块中的每个都检查它的IP地址是否与ARP分组中的目的IP地址相匹配。与之匹配的一个给查询主机发送回一个带有所希望映射的响应ARP分组。

#### 3. 发送数据报到子网以外

### 6.4.2 以太网

+ 以太网是第一个广泛部署的高速局域网
+ 使用总线拓扑的以太网是一种广播局域网,即所有传输的帧传送到与该总线连接的所有适配器并被处理
+ 集线器(hub)是一种物理层设备,作用于各个比特而不是作用于帧。集线器从它的一个接口接收到一个比特，向其所有其他接口发送该比特的副本。如果某集线器同时从两个不同接口接受到帧，将出现一次碰撞，生成该帧的节点必须重新传输该帧。
+ 21世纪初，位于中心的集线器被交换机所替代。交换机不仅是“无碰撞的”，也是名副其实的存储转发分组交换机。

1. 以太网帧结构:
   {{< img src="以太网帧.png" alt="Rectangle" class="border-0" >}}
   + 数据字段(46~1500字节)：大于1500字节分片，小于46字节填充
   + 目的地址(6字节)
   + 源地址(6字节)
   + 类型字段(2字节)：指明该帧使用什么网络层协议
   + CRC(4字节)
   + 前同步码(8字节)：长度为8字节，前7个字节都是10101010用于唤醒接收适配器，同步时钟，最后一个字节是10101011。
   + 以太网技术都向网络层提供不可靠服务
2. 以太网技术
   + "Base"指基带以太网
   + "T"指双绞铜线
   + 通过使用**转发器**能够得到更长的运行距离,而转发器是一种物理层设备,它能在输入端接收信号并在输出端再生该信号
   + 吉比特以太网是极为成功的10Mbps和100Mbps以太网标准的扩展:
      + 使用标准以太网帧格式,并向后兼容10BASE-T与100BASE-T技术
      + 允许点对点链路以及共享的广播信道
      + 使用CSMA/CD来共享广播信道
      + 对于点对点的信道,允许两个方向上都以40Gbps全双工操作

### 6.4.3 链路层交换机

1. 交换机转发和过滤
   + **过滤**是决定一个帧应该转发到某个接口还是应当将其丢弃的交换机功能
   + **转发**是决定一个帧应该被导向哪个接口,并把该帧移动到那些接口的交换机功能
   + 交换机的过滤和转发借助于**交换机表**
   + 交换机表中的一个表项包括:
      + 一个MAC地址
      + 通向该MAC地址的交换机接口
      + 表项放置在表中的时间
   + 交换机过滤和转发的工作过程,假定目的地址为DD-DD-DD-DD-DD-DD的帧从交换机接口x到达,有3种可能的情况:
      + 表中没有对于DD-DD-DD-DD-DD-DD的表项.在这种情况下,交换机向除接口x外的所有接口前面的输出缓存转发该帧的副本.换言之,如果没有对于目的地址的表项,交换机广播该帧.
      + 表中有一个表项将DD-DD-DD-DD-DD-DD与接口x联系起来.在这种情况下,该帧从包括适配器DD-DD-DD-DD-DD-DD的局域网网段到来。无须将该帧转发到任何其他接口，交换机将通过丢弃该帧执行过滤功能即可。
      + 表中有一个表项将DD-DD-DD-DD-DD-DD于接口$y\neq x$联系起来。在这种情况下，该帧需要被转发到与接口$y$相连的局域网网段。交换机通过将该帧放到接口$y$前面的输出缓存完成转发功能。
2. 自学习
   + 交换机通过自学习完成交换表配置
   + 交换机是即插即用设备，因为它们不需要网络管理员或用户的干预。
3. 链路层交换机的性质
   + 消除碰撞
   + 异质的链路
   + 管理
4. 交换机和路由器的比较
   + 路由器是使用网络层地址转发分组的存储转发分组交换机
   + 交换机也是一个存储转发分组交换机，但它和路由器是根本不同的，因为它用MAC地址转发分组。
   + 交换机是第二层的分组交换机，而路由器是第三层的分组交换机，
   + 交换机是即插即用的，具有相对高的分组过滤和转发速率
